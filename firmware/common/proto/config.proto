// Runtime configuration protocol for DOMES firmware
// Shared between firmware (nanopb) and host CLI (prost)
//
// THIS IS THE SINGLE SOURCE OF TRUTH FOR ALL CONFIG PROTOCOL DEFINITIONS.
// DO NOT duplicate these definitions in firmware or CLI code.
syntax = "proto3";
package domes.config;

// Frame-level message types for config protocol (0x20-0x2F range)
// Used in the frame header [0xAA 0x55][Len][MsgType][Payload][CRC32]
enum MsgType {
    MSG_TYPE_UNKNOWN = 0;
    MSG_TYPE_LIST_FEATURES_REQ = 0x20;
    MSG_TYPE_LIST_FEATURES_RSP = 0x21;
    MSG_TYPE_SET_FEATURE_REQ = 0x22;
    MSG_TYPE_SET_FEATURE_RSP = 0x23;
    MSG_TYPE_GET_FEATURE_REQ = 0x24;
    MSG_TYPE_GET_FEATURE_RSP = 0x25;
    MSG_TYPE_SET_LED_PATTERN_REQ = 0x26;
    MSG_TYPE_SET_LED_PATTERN_RSP = 0x27;
    MSG_TYPE_GET_LED_PATTERN_REQ = 0x28;
    MSG_TYPE_GET_LED_PATTERN_RSP = 0x29;
}

// Status codes for responses
enum Status {
    STATUS_OK = 0;
    STATUS_ERROR = 1;
    STATUS_INVALID_FEATURE = 2;
    STATUS_BUSY = 3;
    STATUS_INVALID_PATTERN = 4;
}

// LED pattern types
enum LedPatternType {
    LED_PATTERN_OFF = 0;
    LED_PATTERN_SOLID = 1;
    LED_PATTERN_BREATHING = 2;
    LED_PATTERN_COLOR_CYCLE = 3;
}

// RGBW color (0-255 per channel)
message Color {
    uint32 r = 1;
    uint32 g = 2;
    uint32 b = 3;
    uint32 w = 4;  // White channel (ignored for RGB-only LEDs)
}

// Runtime-toggleable features
enum Feature {
    FEATURE_UNKNOWN = 0;
    FEATURE_LED_EFFECTS = 1;
    FEATURE_BLE_ADVERTISING = 2;
    FEATURE_WIFI = 3;
    FEATURE_ESP_NOW = 4;
    FEATURE_TOUCH = 5;
    FEATURE_HAPTIC = 6;
    FEATURE_AUDIO = 7;
}

// Feature with its current state
message FeatureState {
    Feature feature = 1;
    bool enabled = 2;
}

// Request messages
message ListFeaturesRequest {
    // Empty - lists all features
}

message SetFeatureRequest {
    Feature feature = 1;
    bool enabled = 2;
}

// LED pattern with parameters
message LedPattern {
    LedPatternType type = 1;
    Color color = 2;              // Primary color (for solid/breathing)
    repeated Color colors = 3;    // Color list (for color_cycle)
    uint32 period_ms = 4;         // Animation period in ms
    uint32 brightness = 5;        // Global brightness (0-255)
}

message SetLedPatternRequest {
    LedPattern pattern = 1;
}

message GetLedPatternRequest {
    // Empty - returns current pattern
}

// Response messages
message ListFeaturesResponse {
    repeated FeatureState features = 1;
}

message SetFeatureResponse {
    FeatureState feature = 1;
}

message SetLedPatternResponse {
    LedPattern pattern = 1;
}

message GetLedPatternResponse {
    LedPattern pattern = 1;
}

// Top-level request envelope
message ConfigRequest {
    oneof request {
        ListFeaturesRequest list_features = 1;
        SetFeatureRequest set_feature = 2;
    }
}

// Top-level response envelope
message ConfigResponse {
    Status status = 1;
    oneof response {
        ListFeaturesResponse list_features = 2;
        SetFeatureResponse set_feature = 3;
    }
}
